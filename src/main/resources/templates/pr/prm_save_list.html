<h4 th:text="#{pr.create}"></h4>
<div class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group mr-2">
        <button type="button" class="btn btn-primary" id="add" th:text="#{record.add}"></button>
    </div>
</div>
<div class="card" th:switch="${pr_saved!=null and !pr_saved.empty}">
    <div class="card-header">
        <h5 th:text="#{pr.saved}"></h5>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-sm text-sm-center">
            <thead class="thead-dark">
            <tr>
                <th scope="col">#</th>
                <th scope="col"></th>
                <th scope="col" th:text="#{pr.title}"></th>
                <th scope="col" th:text="#{pr.no}"></th>
                <th scope="col" th:text="#{pr.flow_type_s}"></th>
                <th scope="col" th:text="#{pr.cost_center}"></th>
                <th scope="col" th:text="#{pr.apl.dept}"></th>
                <th scope="col" th:text="#{pr.apl.username}"></th>
                <th scope="col" th:text="#{pr.project.name}"></th>
                <th scope="col" th:text="#{pr.status}"></th>
                <th scope="col" th:text="#{pr.prm.total.estcost}"></th>
                <th scope="col" th:text="#{created.date}"></th>
            </tr>
            </thead>
            <tr th:each="pr,iter:${pr_saved}">
                <td>
                    <span th:text="${iter.index +1 }"></span>
                </td>
                <td>
                    <span class='prm_id' hidden th:text="${pr.id}"></span>
                    <button  type='button' class='btn btn-link u_update'>
                        <i class='fa fa-edit fa-lg' style='color: green'></i>
                    </button>
                    <button type='button' class='btn btn-link a_delete'>
                        <i class='fa fa-trash-o fa-lg' style='color: red '></i>
                    </button>
                </td>
                <td>
                <samll th:text="${pr.prTitle}"></samll>
            </td>
                <td>
                <samll th:text="${pr.prNo}"></samll>
            </td>
                <td>
                    <samll th:text="${pr.flowType}"></samll>
                </td>
                <td>
                    <samll th:text="${pr.costCenter}"></samll>
                </td>
                <td>
                    <samll th:text="${pr.aplDept}"></samll>
                </td>

                <td>
                    <samll th:text="${pr.aplUserName}"></samll>
                </td>

                <td>
                    <samll th:text="${pr.projectName}"></samll>
                </td>
                <td>
                    <samll th:text="${pr.submitted==1} ? #{pr.submitted}:#{pr.saved}"></samll>
                </td>
                <td>
                    <samll th:text="${pr.totalEstCost=='NULL'} ? 0:${pr.totalEstCost}"></samll>
                </td>
                <td>
                    <samll th:text="${#dates.format(pr.prAplDate,'yyyy-MM-dd')}"></samll>
                </td>
            </tr>
        </table>
    </div>
    <div class="row ml-3" th:case="false">
        <h5 th:text="#{no.record}"></h5>
    </div>
</div>
<div class="card mt-3">
    <div class="btn-toolbar mb-2 mb-md-0">
    <button type="button" class="btn btn-info mx-2" id="display_pr_submitted">Display submitted PR</button>
    </div>
    <div class="card-header">
        <h5 th:text="#{pr.submitted}"></h5>
    </div>
    <div id="prm_submitted">
</div>


</div>
<div class="modal fade" id="pr_main_modal" th:fragment="flowContent">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header d-block">
                <h4 class="modal-title" th:text="#{pr.create}"></h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body mx-auto" id="pr_main_details">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" data-dismiss="modal" th:text="#{page.close}"></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="pr_detail_modal" >
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header d-block">
                <h4 class="modal-title" th:text="#{pr.create}"></h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body mx-auto" id="pr_item_details">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" data-dismiss="modal" th:text="#{page.close}"></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="flow_type_modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header d-block">
                <h4 class="modal-title " th:text="#{pr.details.detail}"></h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" id="flow_type_detail">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" data-dismiss="modal" th:text="#{page.close}"></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="prm_delete_modal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header d-block">
                <h4 class="modal-title " th:text="#{page.delete}"></h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div th:text="#{page.delete.alert}"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" th:text="Yes"></button>
                <button type="button" class="btn btn-info" data-dismiss="modal" th:text="#{page.close}"></button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="v_pr_detail_modal" >
    <div class="modal-dialog " style="max-width: 80%!important;" role="document">
        <div class="modal-content">
            <div class="modal-header d-block">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body mx-2" id="v_pr_item_details">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" data-dismiss="modal" th:text="#{page.close}"></button>
            </div>
        </div>
    </div>
</div>
<div id="test"></div>



<script th:inline="javascript">
    $(document).ready(function () {
        $('button.u_update').click(function (e) {
            const id = $(this).closest("td").find(".prm_id").text();

            ajax_getPRMById(id);
        });

        $("#display_pr_submitted").click(function (){
            ajax_displayPRMSubmittedByUser();
        })

        $(".a_delete").click(function (e) {
            e.preventDefault();
            const id = $(this).parent("td").find(".prm_id").text();
            ajax_delPrm(id);
        })

        $("#add").click(function (){
            ajax_getFlowType();
        });

        $(".modal").on('hidden.bs.modal',function (){
            $("#saved_list").trigger("click");
        })
    });
    function ajax_displayPRMSubmittedByUser(){
        $.ajax({
            type: "GET",
            contentType: "text/html",
            url: "/pr/prm/userSubmitted",
            dataType: 'html',
            cache: false,
            async: false,
            success: function (data) {
                $("#prm_submitted").empty();
                $("#prm_submitted").html(data);
            }
        })
    }

    function ajax_getFlowType(){
        $.ajax({
            type: "GET",
            contentType: "text/html",
            url: "/pr/prm/flow_type",
            dataType: 'html',
            cache: false,
            async: false,
            success: function (data) {
                $("#flow_type_detail").empty();
                $("#flow_type_detail").html(data);
                $("#flow_type_modal").modal();
            }
        })
    }

    function  ajax_getPRMById(id){
        $.ajax({
            type: "GET",
            contentType: "text/html",
            url: "pr/prm/" + id,
            dataType: 'html',
            cache: false,
            async: false,
            success: function (data) {
                $el = $("#page_detail");
                $el.empty();
                $el.html(data);
            }
        })
    }

    function ajax_delPrm(id) {

        $("#prm_delete_modal").modal();
        $("#prm_delete_modal .modal-footer button").on("click", function (e) {
            const $button = $(e.target);

            if ($button.text() === "Yes") {

                $.ajax({
                    type: "DELETE",
                    contentType: "text/html",
                    url: "api/pr/prm/" + id,
                    dataType: 'html',
                    cache: false,
                    async: false,
                    success: function (data) {
                        $("#prm_delete_modal").modal('hide');
                    }
                })
            }
        })

    }
</script>